# カスタム指示 (Custom Instructions)

このプロジェクトで開発作業を行う際は、以下のガイドラインに従ってください。

## 言語使用に関するガイドライン

### 日本語で記述するもの
- プルリクエストのタイトルと概要
- プルリクエストのコメント
- Issueのタイトルと説明
- Issueのコメント
- コミットメッセージ（日本語推奨）
- ドキュメントの説明文

### 英語で記述するもの
- コードのコメント（インライン、ブロックコメント）
- スクリプトファイルのコメント
- 変数名、関数名、クラス名
- 技術的なドキュメントのコードサンプル内のコメント

## 例

### プルリクエストの例
```
タイトル: 新機能：赤ちゃんの発話記録機能を追加
概要: 
このプルリクエストでは、赤ちゃんの初めての言葉を記録する機能を実装しました。
主な変更点：
- 発話記録のデータモデルを作成
- 記録画面のUIを実装
- データの保存機能を追加
```

### コードコメントの例
```javascript
// Record baby's first words with timestamp
function recordFirstWord(word, timestamp) {
  // Validate input parameters
  if (!word || !timestamp) {
    throw new Error('Word and timestamp are required');
  }
  
  // Save to local storage
  saveToStorage(word, timestamp);
}
```

このガイドラインに従うことで、プロジェクトのコミュニケーションと技術文書の一貫性を保つことができます。

---

## Microsoft公式ドキュメント検索（MCPサーバ利用）

あなたは `microsoft.docs.mcp` というMCPサーバにアクセスできます。このツールを使うことで、Microsoft公式ドキュメントの最新情報を検索できます。これはあなたの学習データセットよりも新しく、より詳細な情報が含まれている場合があります。

特に、Microsoft Azure、C#、F#、ASP.NET Core、Microsoft.Extensions、NuGet、Entity Framework、`dotnet` ランタイムなど、Microsoftのネイティブ技術に関する具体的・限定的な質問に対応する際は、このツールを積極的に活用して調査・回答してください。

## Microsoft Azure作業時のガイドライン（Copilot/AI向け）

- Azureリソースの作成・構成・デプロイ・管理に関する作業は、必ず[Microsoft Learn](https://learn.microsoft.com/azure/)や公式ドキュメント（英語版）を参照し、最新の仕様・推奨事項に従うこと。
- Bicep/ARMテンプレート、CLI、Portal操作なども同様。
- AzureリソースのBicep/ARM記述は「必須・推奨プロパティのみ明示」し、デフォルト値は極力省略する。
- セキュリティ・運用要件で明示が必要な場合のみ、デフォルト値を明記する。
- サンプルやテンプレートは[Azure公式サンプル](https://github.com/Azure-Samples)やMicrosoft Learn掲載例（英語版）を優先的に参考にする。
- コードや設定の根拠となる公式URLをコメントやPRに必ず添付する。
- コードコメントやドキュメントにも、Azureの公式用語・命名規則・推奨表現を使う。
- PRやIssueには「なぜその設定・構成にしたか」「公式ドキュメントのどこを根拠にしたか」を日本語で明記する。
- Azureの仕様変更や新機能リリース時は、必ずMicrosoft Learn（英語版）で最新情報を確認し、必要に応じてBicep/ARMやREADME、運用手順を更新する。

### 参考リンク（英語版を参照すること）

- [Microsoft Learn: Azure](https://learn.microsoft.com/azure/)
- [Azure Bicep Best Practices](https://learn.microsoft.com/azure/azure-resource-manager/bicep/best-practices)
- [What is Azure Static Web Apps?](https://learn.microsoft.com/azure/static-web-apps/overview)
- [Azure Functions Best Practices](https://learn.microsoft.com/azure/azure-functions/functions-best-practices)

---

## GitHub Copilot Code Review ガイドライン

このセクションはGitHub Copilot Code Reviewによる自動コードレビュー時に適用される基準です。

### 全般的なコード品質

#### コードの明確性と保守性
- コードが自己説明的であり、意図が明確であることを確認する
- 複雑なロジックには適切な英語コメントで説明を追加する
- マジックナンバーや不明瞭な定数は名前付き定数として定義する
- 関数やメソッドは単一責任の原則に従っているか確認する

#### 命名規則の一貫性
- 変数、関数、クラス名が適切で説明的であることを確認する
- プロジェクト全体で一貫した命名規則が使用されているか確認する
- TypeScript: camelCase（変数・関数）、PascalCase（クラス・インターフェース）、UPPER_CASE（定数）

#### エラーハンドリング
- すべての外部サービス呼び出し（DB、HTTP）がtry-catchでラップされているか確認する
- エラーメッセージが具体的で、デバッグに役立つ情報を含んでいるか確認する
- エラーが適切にログ出力され、必要に応じて再スローされているか確認する

### セキュリティ

#### 機密情報の保護
- ハードコードされた認証情報、APIキー、接続文字列がないことを確認する
- 機密情報は環境変数から取得されているか確認する
- ログ出力に機密情報（パスワード、トークン、個人情報）が含まれていないか確認する

#### 入力検証とサニタイゼーション
- すべてのユーザー入力が適切に検証されているか確認する
- SQLインジェクション、XSS、その他のインジェクション攻撃への対策があるか確認する
- 外部から受け取ったデータを信頼せず、型チェックと検証を行っているか確認する

### TypeScript 固有の確認項目

#### 型の安全性
- 明示的な型注釈がパラメータと戻り値に付与されているか確認する
- `any`型の使用を避け、具体的な型またはジェネリクスを使用しているか確認する
- 型アサーション（`as`）の使用が本当に必要か、より安全な方法がないか確認する
- 非nullアサーション演算子（`!`）の使用が適切か確認する

#### 非同期処理
- async/awaitが適切に使用されているか確認する
- Promise処理でエラーハンドリングが漏れていないか確認する
- 並行処理が可能な場合、Promise.allなどを使用して最適化されているか確認する

### データベース（Cosmos DB）関連

#### 接続管理
- データベース接続がシングルトンパターンで再利用されているか確認する
- 接続文字列が環境変数から取得され、適切に検証されているか確認する
- 必須の環境変数が設定されていない場合、明確なエラーメッセージを返すか確認する

#### CRUD操作の一貫性
- CRUD操作のメソッド名が統一されているか確認する（createItem、getItem、queryItems、updateItem、deleteItem）
- すべてのデータベース操作に適切なエラーハンドリングが実装されているか確認する
- パーティションキーが適切に使用されているか確認する
- 型安全性を保つためにジェネリクス（`<T>`）が使用されているか確認する

### Azure Functions 固有の確認項目

#### 関数設計
- 各関数が単一責任を持っているか確認する
- authLevelが適切に設定されているか確認する（productionでは'function'以上を推奨）
- HTTPメソッドが適切に指定されているか確認する

#### レスポンス形式
- 一貫したレスポンス構造が使用されているか確認する
- 適切なHTTPステータスコードが返されているか確認する（2xx, 4xx, 5xx）
- Content-TypeやCache-Controlなどの適切なヘッダーが設定されているか確認する

### Nuxt/Vue 固有の確認項目

#### コンポーネント設計
- Composition API（`<script setup>`）が使用されているか確認する
- コンポーネントが適切にpropsとemitsを型付けしているか確認する
- 単一責任の原則に従った小さく再利用可能なコンポーネントになっているか確認する

#### サーバーAPI
- defineEventHandlerが適切に使用されているか確認する
- レスポンスヘッダーとステータスコードが適切に設定されているか確認する
- エンドポイント間で一貫したレスポンス形式が使用されているか確認する

### パフォーマンス

#### リソース効率
- データベースクライアントインスタンスが再利用されているか確認する（シングルトンパターン）
- 不要なデータの取得を避け、必要なフィールドのみをクエリしているか確認する
- 適切なキャッシュ戦略が実装されているか確認する

#### 最適化の機会
- 不要な計算や処理の重複がないか確認する
- ループ内での非効率な処理がないか確認する
- 大量データ処理時のメモリ効率を考慮しているか確認する

### テスタビリティ

#### テスト容易性
- ビジネスロジックがフレームワーク固有のコードから分離されているか確認する
- 依存性注入パターンが適切に使用されているか確認する
- 外部依存（データベース、API）がモック可能な設計になっているか確認する

### コードレビューでの重点確認事項

#### 変更の影響範囲
- 変更が既存の機能に悪影響を与えないか確認する
- 破壊的変更の場合、適切な移行パスや文書化がされているか確認する
- 変更の理由と意図が明確に説明されているか確認する

#### ベストプラクティスの遵守
- プロジェクト固有のコーディング規約に従っているか確認する
- Azure、TypeScript、Nuxt/Vueのベストプラクティスに従っているか確認する
- 公式ドキュメントで推奨されているパターンを使用しているか確認する

#### 文書化
- 公開APIには適切なJSDocコメントが付与されているか確認する
- 複雑なビジネスロジックには説明コメントが追加されているか確認する
- READMEや関連ドキュメントが必要に応じて更新されているか確認する

### Path-Specific Instructions

このリポジトリでは、以下のパス固有の指示ファイルが適用されます：

- `.github/instructions/api.instructions.md`: `src/api/` 配下のAzure Functions APIコードに適用
- `.github/instructions/web.instructions.md`: `src/web/` 配下のNuxt/Vueアプリケーションコードに適用

これらのファイルには、各モジュール固有の詳細なコーディング規約が定義されています。コードレビュー時は、該当するpath-specific instructionsも参照してください。
